(function(z){
var ZI=function(a,b){a.Tt=b};var $I=function(a){for(var b in a)return b};var aJ=function(a){if(!arguments.length)return[];for(var b=[],c=arguments[0].length,d=1;d<arguments.length;d++)arguments[d].length<c&&(c=arguments[d].length);for(d=0;d<c;d++){for(var f=[],g=0;g<arguments.length;g++)f.push(arguments[g][d]);b.push(f)}return b};
var bJ=function(a,b){z.G.call(this);var c=this.J={};z.Mb(c,this.defaults,b||{});this.input=a;this.Nb=c.Nb;this.ci=this.MW();this.Ox=[];this.Ox.push({action:"remove",method:this.removeTag,jy:c.tX,na:"删除"});(0,window.setTimeout)((0,z.t)(this.fh,this))};
var cJ=function(a,b){var c={qd:function(a,b,c){c.innerHTML=f(a.data)}};z.Mb(c,b||{});var d=new z.jt(a,c);z.F(d,"show",function(){1<d.Oa.length&&!d.Oa[0].id&&z.Es(d)});var f=(0,z.sw)('\x3c% if (data.avatar) { %\x3e\x3cimg class\x3d"zm-item-img-avatar zg-left" src\x3d"\x3c%\x3davatar%\x3e"\x3e\x3c% } %\x3e\x3c% if(data.type \x3d\x3d\x3d "search_link" || !data.id){ %\x3e\x3cspan class\x3d"zu-autocomplete-row-name zu-autocomplete-row-name-info"\x3e\x3c%\x3ddata.type \x3d\x3d\x3d "search_link"?("添加 "+label+" 话题"):label%\x3e\x3c/span\x3e\x3c% } else { %\x3e\x3cspan class\x3d"zu-autocomplete-row-name"\x3e\x3c%\x3dlabel%\x3e\x3c/span\x3e\x3c% } %\x3e\x3cspan class\x3d"zg-gray-normal zu-autocomplete-row-description"\x3e\x3c% if (data.alias \x26\x26 data.followers) { %\x3e\x3c% if ( data.alias ) { %\x3e又称 \x3c%\x3dalias%\x3e\x3c% } %\x3e\x3c% if ( data.alias \x26\x26 data.followers ){ %\x3e，\x3c% } %\x3e\x3c% if ( data.followers ){ %\x3e\x3c%\x3dfollowers%\x3e 人关注\x3c% } %\x3e\x3c% }else{ %\x3e\x26nbsp;\x3c% } %\x3e\x3c/span\x3e');return d};
var dJ=function(){this.ZD=this.bE=null};
var eJ=function(a){function b(a,b){var c=z.M("li"),f=z.M("span","item-label",a);c.appendChild(f);var h=new z.lq("",z.uq.ba());h.oi("icon-delete");h.eb(!0);h.Pd("移除动作");h.Da(b);h.addEventListener("action",function(){var a=h.X();g(a,!1);z.N(c);k.Mq(!0);d()});h.render(c);p.appendChild(c)}function c(){l.F(k.qm()!==f().length)}function d(){z.A(h,function(a){a.selected||(a=new z.yE(a.text,a.value),k.Ha(a))});c()}function f(){return z.lb(k.nb(),function(a){return!!(a.N&8)})}function g(a,b){var c=z.pb(h,
function(b){return b.value===a});c&&(c.selected=b)}z.P(a,!1);var h=a.options,k=new z.oA;k.on("action",function(a){a=a.target;b(a.th(),a.X());g(a.X(),!0);k.removeItem(a);c()});var l=new z.vA("添加动作",k);l.oi("menu-button");l.render(a.parentNode);l.dj=!0;z.xA(l);var p=z.M("ul","display-list");d();(function(){z.A(h,function(a){a.selected&&b(a.text,a.value)})})();a.parentNode.insertBefore(p,l.m())};
var fJ=function(a){function b(){var b=f.text()||0;0<b&&f.text(b-1);gJ(a)}var c=(0,window.$)("#rq3-item-list"),d={XY:function(a){return window.$.post("/watch/thank",{id:a,rq_type:"thank"})},read:function(a){return window.$.post("/watch/seen",{id:a,rq_type:"seen"})}};c.on("click",".read-button",function(){var a=(0,window.$)(this).closest(".rq-item"),c=a.data("id");d.read(c);b();a.slideUp(function(){a.remove()})}).on("click",".thank-button",function(a){a.preventDefault();a=(0,window.$)(this);var b=a.closest(".rq-item").data("id");
a.hasClass("thanked")||(d.XY(b),a.addClass("thanked").text("已感谢"))});z.QE(c);c=new z.zE(c.get(0),window.location.href,!0);c.SB=function(a){return a.getAttribute("data-id")};c.mj("rq-item");c.init();var c=(0,window.$)("#rq3-sidenav-link"),f=(0,window.$)(".zg-num",c);a.bE=f};var gJ=function(a){var b=a.ZD,c=Number(a.bE.text());(0,window.setTimeout)(function(){b.toggleClass("hidden",!!c)},210)};var hJ=function(a){z.Q.apply(this,arguments)};var iJ=function(){z.Q.call(this)};var jJ=function(){z.Q.call(this)};
var kJ=function(a){var b=z.J("zh-question-log-list-wrap");if(b){var c=new z.El;a.K(c);c.use("locationSource",{RB:!0});c.w(b);(0,window.$)(b).on("click",'a[name\x3d"revert"]',function(){if(!1===z.RE({Hq:!0})())return!1;z.NE(this);return!1}).on("click",'.zm-item-meta a[name\x3d"report"]',function(){z.S.trackEvent(this,{action:"Report",element:"Button"});(new z.qC({type:"activity",id:(0,window.$)(this).data("id")})).submit()});z.dl(c,function(a){return z.S.Xa(a,{module:"LogItem"},function(){return{card:{card_type:"Content",
content:{type:"Log",id:(0,window.$)(a).attr("id").replace(/logitem-/,"")}}}})})}};var lJ=function(){z.Q.call(this);this.KG="even";this.Fo="current"};var mJ=function(a,b){return a.Fw.filter(function(){return(0,window.$)(this).text()===b})};var nJ=function(a,b){return a.Fw.filter(function(){return(0,window.$)(this).attr("data-id")===String(b)})};var oJ=function(){z.Q.call(this)};var pJ=function(){};var qJ=function(){z.Q.call(this)};var rJ=function(){z.Q.call(this)};
var sJ=function(){var a=window.document.getElementById("react-copyright");a&&(z.sx("Copyright").then(function(b){return b.render(a)}),window.setTimeout(function(){var b=(0,window.$)(a).find(".js-loading-block");b.length&&b.removeAttr("hidden").append("加载中……")},1E3))};
var tJ=function(a){if((0,window.$)(".community-copyright-content").length){var b=(0,window.$)(".community-copyright-faq");z.A(aJ(b.find("dt").get(),b.find("dd").get()),function(a){new z.wq(a[0],a[1])});var c=(0,window.$)(".community-copyright-form"),b=(0,window.$)("button.submit-button",c);(0,window.$)('input[name\x3d"original"]',c);var d=(0,window.$)('textarea[name\x3d"description"]',c);new z.gs(d[0]);var f=function(){(0,window.$)("[placeholder]",c).placeholder()},g=function(a){a.removeClass("uneditable");
(0,window.$)(".url-input",a).val("");(0,window.$)(".title-input",a).val("");f()},h=function(a){return function(b){var d=$I(b),f=(0,window.$)(z.Ja('input[name\x3d"%s"]',d),c);b=a(b[d]);b.then(function(a){var b=f.parent();b.addClass("uneditable");(0,window.$)(".title-input",b).val(a.title)},z.r);return b}},k=function(a,b){return new window.Promise(function(c,d){window.$.post(a,b).then(c,function(a){d(a.responseJSON)})})},l=/\/question\/\d+(\/answer\/|#answer-)\d+/,p=/zhuanlan\./,q=/\/\/mp\.weixin\.qq\.com\//,
v=window.location.pathname,I={SX:function(a){return l.test(a)||p.test(a)?k(v+"/validate",{url:a}):window.Promise.reject({message:"请填写正确的回答或者文章链接"})},TX:function(a){return q.test(a)?new window.Promise(function(b,c){window.$.post("/scraper",{url:a}).then(function(a){a&&"link"===a.type?b(a):c({message:"请填写正确的链接"})},function(){c({message:"请填写正确的链接"})})}):window.Promise.reject({message:"微信公众平台以外的维权请联系 banquan@zhihu.com"})},submit:function(a){return k(v,{data:JSON.stringify(a)})}},K={promise:[h(I.SX)]},
O={promise:[h(I.TX)]},ba=(0,window.$)(".copies",c),Va=(0,window.$)(".copies-footer",c),Sa=(0,window.$)("#copies-item-tmpl").html(),Aa=0,ua=function(){Va.toggle(199>=ba.children().length)},Id=function(){function a(b){return{url:(0,window.$)(".url-input",b).val(),title:(0,window.$)(".title-input",b).val()}}return{original:a((0,window.$)(".link-inputs.original",c)),copies:z.mb((0,window.$)(".link-inputs.uneditable",ba).get(),a),description:d.val()}},wi=function(){(0,window.$)(".copies-item",c).slice(1).remove();
(0,window.$)(".link-inputs",c).each(function(){g((0,window.$)(this))});c[0].reset();Sd.resetForm();ua()},ue=function(){function a(){--b;b?((0,window.$)(".countdown-text",d.S()).text(b),(0,window.setTimeout)(a,1E3)):(wi(),d.F(!1))}var b=5,c=z.Ja('\x3cp class\x3d"text-center"\x3e\x3cspan class\x3d"sprite-rare-icon-ok"\x3e\x3c/span\x3e\x3cbr\x3e\x3cbr\x3e处理成功后会通过站内私信通知您\x3cbr\x3e\x3csmall class\x3d"text-muted"\x3e\x3cspan class\x3d"countdown-text"\x3e%s\x3c/span\x3e 秒后窗口自动关闭\x3c/small\x3e\x3c/p\x3e',
b),d=new z.U;d.La("提交成功");d.aa(c);d.F(!0);(0,window.setTimeout)(a,1E3)};c.on("click","button.copies-item-remove-button",function(){(0,window.$)(this).closest(".copies-item").remove();ua()}).on("click","button.copies-item-add-button",function(){Aa+=1;var a=(0,window.$)(Sa).appendTo(ba);(0,window.$)("input.url-input",a).focus().attr("name","copy-"+Aa).rules("add",O);f();ua()}).on("change input paste","input.title-input",function(){g((0,window.$)(this).parent())});var Sd=c.validate({rules:{original:K,
copy:O},errorPlacement:function(a,b){a.insertAfter(b.parent())},submitHandler:z.uk(b,function(){var a=Id();return a.copies.length?I.submit(a).then(ue,function(a){z.W.message(a?a.message:"提交失败请稍后重试")}):z.W.message("必须填写至少一条填写侵权的内容链接")})});f();(function(){(0,window.$)(window).on("beforeunload",function(){var a=Id();if(a.original.title||a.copies.length)return"你对投诉还未提交，确认离开该页面吗？"})})();(function(){(0,window.$)(".js-bind-wechat").click(function(a){z.cz().then(function(){return window.open(a.target.href)});
return!1});a.o().g(z.X,"wechat_callback",function(){return window.location.reload()}).g(z.X,"oauth_error_callback",function(a){return z.W.alert(a.Uf.message)})})()}};var uJ=function(){z.Q.call(this)};var vJ=function(){window.document.getElementById("react")&&z.sx("Community").then(function(a){return a.render()})};var wJ=function(){z.Q.call(this)};var xJ=function(a){xJ.jP(this,"constructor");this.token=a.token;this.type=a.type;this.JK=a.price;this.title=a.title};
var yJ=function(a){z.mk.call(this,"publication-qrcodePayDialog");this.url=a};var zJ=function(a){if(a)return a=new yJ(a),a.F(!0),a};
var AJ=function(a){var b=(0,window.$)(".publication-header-vote"),c=b.get(0);if(c){var d=new z.YD(a.token,"publications");d.w(c);a.o().g(d,"change",function(){(0,window.$)("[data-bind-votecount]",c).text(z.fs(d.mb()))});var f=b.find("button");f.on("click",z.Xq(function(b){b.preventDefault();if(!f.hasClass("progressing")){f.addClass("progressing");var c=d.mb(),k=void 0;f.hasClass("active")?(k=z.$D.Nn(a.token,"neutral").then(function(){f.removeClass("active");d.Yq(c-1)}),z.S.trackEvent(b.target,{action:"UnUpvote"})):
(k=z.$D.Nn(a.token,"up").then(function(){f.addClass("active");d.Yq(c+1)}),z.S.trackEvent(b.target,{action:"Upvote"}));k.always(function(){f.removeClass("progressing")})}},{Rd:!0}))}};var BJ=function(a){return z.$D.vP(a.token,{price:a.JK}).then(null,function(a){0!==a.status||a.message||(a.message="网络连接异常");return a})};
var CJ=function(a){function b(a,b){var c=(0,window.$)("#react-payment-app").get(0),d=this;a.render(c,{title:"购买电子书",subTitle:this.title,price:this.JK,tradeNumber:b.trade_number,serviceId:b.service_id,buyableToken:b.buyable_token,buyableId:b.buyable_id,categoryCouponAllowed:b.category_coupon_allowed,jsSDKSrc:/\.(aws|zhihu)\.dev$/.test(window.location.host)?"http://zxin.aws.dev/temp/trade.js":"https://pay.zhihu.com/api/js",onSuccess:function(){a.unmount(c);(0,window.$)(".js-publication-buy").remove();
(0,window.$)(".js-publication-read").removeAttr("disabled hidden");DJ(d);z.Ai({category:"publications",action:"buy_success",label:"publications_card"});z.S.trackEvent((0,window.$)(".js-publication-buy"),{action:"Pay"},{payment:{id:b.trade_number}})},onError:function(b){z.W.alert(b.message||"支付失败");a.unmount(c)},onRequestClose:function(){a.unmount(c)},onBeforeJumpPay:function(a,b){z.Uh.set("pub:wechat_pay",b.tradeNumber)}})}function c(a,b){b=void 0===b?3E3:b;var c=new window.zhihu.pay.Trade(a.trade_number,
a.service_id);return new window.Promise(function(a){c.getPaymentsList(function(){c.on("payInited",function(b,d){zJ(d.codeUrl).g("hide",function(){return c.dispose()});(0,window.setTimeout)(a,300)}).on("paySuccess",function(){z.Uh.remove(1002);window.location.search=""}).initWechatPay({forceQRCode:!0});(0,window.setTimeout)(a,b)})})}var d=(0,window.$)(".js-publication-buy");d.on("click",function(a){z.S.trackEvent(a.target,{action:"Pay",is_intent:!0})});if(z.ym&&!z.gh)d.on("click",function(){(0,z.Lm)("zhihu://publications/book/"+
a.token)});else{if(z.gh)if(z.Y.ib()){var f=(new z.th(window.location.href)).Dd();if(1002===Number(f.get("status"))&&f.get("trade_number")===z.Uh.get("pub:wechat_pay")){f=function(){d.attr("disabled",!0);a.yU(function(){BJ(a).then(c).then(function(){return d.attr("disabled",!1)})})};d.on("click",f);f();return}}else{d.on("click",function(){(0,window.$)("body").addClass("publication-modal-open")});(0,window.$)(".publication-modal-wrapper, .publication-modal-close").on("click",function(){(0,window.$)("body").removeClass("publication-modal-open")});
(0,window.$)(".publication-modal").on("click",function(a){a.stopPropagation()});(0,window.$)(".publication-modal-button--zhihu").on("click",function(){window.open("https://www.zhihu.com/signin?next\x3d"+(0,window.encodeURIComponent)(window.location.href))});(0,window.$)(".publication-modal-button--wechat").on("click",function(){z.ak("wechat")});return}z.sx("PayUIApp");d.on("click",z.Xq(function(){d.attr("disabled",!0);window.Promise.all([z.sx("PayUIApp"),BJ(a)]).then(function(c){var d=z.ha(c);c=d.next().value;
d=d.next().value;return b.call(a,c,d)}).catch(function(a){z.W.alert(a.message||a.responseJSON&&a.responseJSON.message||"未知异常")}).then(function(){return d.attr("disabled",!1)});z.Ai({category:"publications",action:"click_buy",label:"publications_card"})},{Rd:!0}))}};
var DJ=function(a){var b=(0,window.$)(".js-publication-read");if(b.length&&!b.attr("disabled"))if(z.Uj)b.on("click",function(){(0,z.Lm)("zhihu://publications/book/"+a.token)});else{var c=void 0,d=function(){c||(c=new z.U,c.aa((0,window.$)("#read-dialog-template").html()),c.La((0,window.$)(".js-publication-read").text()),z.V.add(c.uh(),"publication-read-dialog"));c.aa((0,window.$)("#read-dialog-template").html());(0,window.$)(".publication-read-dialog a").one("click",function(a){a.preventDefault();
c.aa((0,window.$)("#read-dialog-qrcode-template").html())});c.F(!0);z.Ai({category:"publications",action:"click_read",label:"publications_card"})};b.on("click",z.Xq(function(){BJ(a).always(d)}))}};
var EJ=function(){var a=void 0;(0,window.$)(".js-channels").click(function(b){if(!a){a=new z.U;(0,window.$)(a.S()).addClass("publication-dialog");var c=(0,window.$)("#channels-dialog-template").html();a.aa(c)}a.La("获取方式");a.F(!0);z.Tj(a,"290px");z.Ai({category:"publications",action:"click_channels",label:"publications_card"});z.S.trackEvent(b.target,{action:"Click",element_name:"ChooseOtherPurchaseChannel"})})};
var FJ=function(a){a=new z.lD(a.token,"ebook");a.yx=!1;a.render((0,window.$)(".publication-comments").get(0),{standalone:!0});a.Jc(!0)};var GJ=function(){z.xm&&(window.location.href="zhihu://webviewform/done")};z.y(bJ,z.G);
z.Ca(bJ.prototype,{defaults:{source:"/topic/autocomplete",Nb:null,gQ:"",Ux:!1,GZ:"/topic/%s",template:'\x3cli data-id\x3d"\x3c%\x3did%\x3e"\x3e\x3ca class\x3d"tag-link" href\x3d"\x3c%\x3durl%\x3e"\x3e\x3c%\x3dname%\x3e\x3c/a\x3e\x3c/li\x3e',parse:function(a){var b=(0,window.$)(a);return{Av:!0,id:b.data("id"),url:a.href,name:b.text()}},uY:z.Hl,DQ:"canedit",Gy:"empty",Ml:"button",tX:"remove-button"},SY:function(a){return z.fl(this.J.GZ,a.url_token)},has:function(a){return!!z.pb(this.ci,function(b){return b.name===
a.name||b.id===a.id})},SQ:function(a){return z.pb(this.ci,function(b){return b.name===a})},j0:function(a){return z.pb(this.ci,function(b){return b.id===a})},Uc:function(){var a=!!z.gf(this.Nb).length;z.V.enable(this.Nb,this.J.Gy,!a);this.dispatchEvent("change")},add:function(a,b){a&&(this.has(a)||this.ci.push(a),a.Av=!1,b||this.J.uY.call(this,a))&&(this.BX(a),a.Av=!0,this.dispatchEvent("add"),this.Uc())},remove:function(a){this.ci=z.lb(this.ci,function(b){return a!==b.id},this);this.dispatchEvent("remove");
this.Uc()},oR:function(){return z.lb(this.ci,function(a){return!1!==a.Av})},nR:function(){return z.mb(this.oR(),function(a){return a.id})},BX:function(a){a=z.Ye(this.dL(a));this.Nb.appendChild(a);this.ze(a)},dL:function(a){return(0,z.sw)(this.J.template,a)},render:function(){this.Nb.innerHTML=z.mb(this.ci,this.dL,this).join("")},MW:function(){return z.mb(this.nH(),this.J.parse)},nH:function(){return z.gf(this.Nb)},fh:function(){var a=this,b=a.J;this.Y=cJ(this.input,{source:b.source,ej:function(a){return z.wf(a,
function(a){return"static"!==window.$.css(a,"position")})}(a.input),placeholder:this.input.getAttribute("placeholder"),select:function(c){a.add({id:c.id,name:c.id?c.label:a.input.value,url:a.SY(c),avatar:c.avatar,url_token:c.url_token});return b.gQ},filter:function(c){return z.lb(c,function(c){return b.Ux&&!c.id?!1:!z.pb(a.ci,function(a){return a.Av&&a.id===c.id})})}});z.A(this.nH(),this.ze,this);z.F(this.input,"keypress",function(c){var d;13!==c.keyCode||b.Ux||!(d=(0,z.ab)(this.value))||a.Y.Db()||
a.add(a.SQ(d)||{id:null,name:d,url:"/topic/"+d})});this.Uc()},removeTag:function(a){this.remove((0,window.$)(a).remove().data("id"))},OW:function(a,b){var c=z.pb(this.Ox,function(b){return b.action===a});c&&c.method&&c.method.call(this,b);this.input.focus()},ze:function(a){var b=this.J;z.V.add(a,b.DQ);z.A(this.Ox,function(c){var d=new z.lq(" ",z.uq.ba());d.oi([b.Ml,c.jy].join(" "));d.render(a);d.eb(!0);d.Pd(c.na);d.addEventListener("action",function(){this.OW(c.action,a)},!1,this)},this)}});dJ.prototype.init=function(){this.mA();fJ(this)};
dJ.prototype.mA=function(){function a(){var a=window.$.grep(d.get(0).options,function(a){return a.selected});window.$.map(a,function(a){return a.value})}function b(){f=l.nR();p.val(f.join(","))}var c=(0,window.$)("#rq-settings-ui"),d=(0,window.$)("select.select",c);(0,window.$)(".topics-num",c);(0,window.$)(".actions-num",c);var f=[];this.ZD=(0,window.$)("#rq-info-block");c.on("click",".beginedit-button",function(a){a.preventDefault();c.addClass("expanded-view")}).on("click",".exitedit-button",function(a){a.preventDefault();
c.removeClass("expanded-view")}).on("click",".endedit-button",function(a){a.preventDefault();c.get(0).submit()});var g=(0,window.$)(".topic-editor",c),h=(0,window.$)("input.topic-input",g).get(0),k=(0,window.$)("ul.tag-list",g).get(0),l=new bJ(h,{Ux:!0,Nb:k}),p=(0,window.$)('input[name\x3d"topics"]',g);l.on("change",b);d.on("change",a);b();a();eJ(d.get(0))};z.n(hJ,z.Q);hJ.prototype.VH=function(){var a=window.location.hash.slice(1);a&&(a=(0,window.$)('[data-section\x3d"'+a+'"]'),a.length&&z.Lr(a[0]))};hJ.prototype.init=function(){(0,window.$)("a.js-obfuscate-email").each(function(){var a=(0,window.$)(this),b=a.data("email").split("").reverse().join("");a.attr("href","mailto:"+b).text(b)});this.VH();this.o().g(window,"hashchange",this.VH)};z.y(iJ,z.Q);z.e=iJ.prototype;z.e.init=function(){var a=z.J("zh-noti7");a&&this.w(a)};z.e.C=function(){iJ.v.C.call(this);this.sm();this.o().g(this.h,"click",this.Wa)};z.e.Wa=function(a){a=a.target;if(a.name)switch(a.name){case "fold":(0,window.$)(a).parent().hide().prev().animate({height:"show"},200);break;case "fold-follow":(0,window.$)(a).parent().hide().prev().show();break;case "unfold-item":(0,window.$)(a).parent(".author-list").hide().siblings(".hidden").show()}};
z.e.sm=function(){this.aq||(this.aq=!0,this.Fk=new z.yp(!1),this.o().g(this.Fk,"success",this.LV),this.Fk.ajax("/noti7/calendar","","GET"))};z.e.LV=function(){this.aq=!1;var a=z.se(this.Fk);if(a){var b=z.J("zh-noti7-list-inner");/category/.test(a)?(b.innerHTML=a,b&&(a=new z.zE(b,"/noti7/calendar",!0),a.ms=function(a){var b=z.M("div","zm-item-more-wrap");b.innerHTML=a;z.cf(b,this.ce)},ZI(a,function(a){this.Wv=this.ce.getAttribute("data-next");return!a||a.msg[0]&&a.msg[1]}),a.init())):b.innerHTML='\x3cdiv class\x3d"empty"\x3e\x3cspan class\x3d"zg-gray-normal"\x3e您收到的消息会显示在这里\x3c/span\x3e\x3c/div\x3e'}};z.y(jJ,z.Q);jJ.prototype.init=function(){z.lH.K(this);this.w(window.document.body)};jJ.prototype.C=function(){jJ.v.C.call(this);kJ(this)};z.y(lJ,z.Q);z.e=lJ.prototype;z.e.init=function(){z.lH.K(this);this.w(window.document.body)};
z.e.C=function(){lJ.v.C.call(this);this.Fw=(0,window.$)("ul.zm-topic-cat-main").children();var a=this.Ya=(0,window.$)("div.zh-general-list"),b=new z.El({use:["autoload","nodeSource"]});this.K(b);b.w(a.get(0));this.o().g(b,"next",this.es);this.ef=b;a.on("click","a.follow",function(){(0,z.iH)(this,"topic",z.Ba(z.Lr,this),null,{follow_text:"关注"})});z.F(window,"hashchange",this.cK,!1,this);this.cK()||(a.show(),this.es())};
z.e.es=function(){var a=this.Ya.show().children();if(!a.length)return this.Ya.html('\x3cp class\x3d"zg-gray-normal" style\x3d"text-align:center;line-height:4;"\x3e没有子话题。\x3c/p\x3e');a.removeClass("no-border "+this.KG);a.filter(":odd").addClass(this.KG);a=a.last();a.index()%2?a.add(a.prev()).addClass("no-border"):a.addClass("no-border");a=this.Ct();a=nJ(this,a.params&&a.params.topic_id);a.length&&a.addClass(this.Fo).siblings().removeClass(this.Fo)};z.e.Ct=function(){return this.Ya.data("init")};
z.e.cK=function(){var a;a:{if(a=(0,window.decodeURIComponent)(window.location.hash.slice(1))){var b=mJ(this,a);if(b.length&&this.Fw.filter("."+this.Fo).text()!==a){b.addClass(this.Fo).siblings().removeClass(this.Fo);a={params:{topic_id:b.data("id")}};b=this.Ct();window.$.extend(!0,b,a);this.Ya.attr("data-init",JSON.stringify(b));this.Ya.empty();this.ef.kh();this.ef.Dg();a=!0;break a}}a=void 0}return a};z.y(oJ,z.Q);oJ.prototype.C=function(){this.o().g(this.h,"click",this.rq)};oJ.prototype.rq=function(a){var b=a.target;if(b&&("rmdraft"===b.name||"rmarticle"===b.name)){var c=this;z.W.confirm("删除草稿","你确定要删除这个草稿吗？",function(a){a&&(z.zp("/draft/delete",null,"POST",[{rmdraft:"qid",rmarticle:"did"}[b.name],b.id.split("-")[1]].join("\x3d")),z.N(c.h))})}};z.y(pJ,z.Q);pJ.prototype.init=function(){var a=z.J("zh-draft-page-wrap");a&&this.w(a)};pJ.prototype.C=function(){this.Bp()};
pJ.prototype.Bp=function(){var a=z.J("zh-draft-item-list");if(a){var b=new z.El;b.use("locationSource").use("childConstructor",{Qj:oJ});b.w(a)}};z.y(qJ,z.Q);z.e=qJ.prototype;z.e.init=function(){var a=z.L("zm-invite-container");a&&this.w(a)};z.e.C=function(){qJ.v.C.call(this);var a=z.J("zh-invite-select");a&&this.o().g(a,"change",this.EB);(a=z.L("zm-invite-list"))&&this.o().g(a,"click",this.Wa);(this.aA=z.J("zh-invite-ignore-all-btn"))&&this.o().g(this.aA,"click",this.nT)};
z.e.Wa=function(a){(a=a.target)&&a.name&&("ignore"===a.name&&this.vq(a),"recover"!==a.name||this.YK||(this.WK=a,this.YK=!0,z.V.add(a,"zg-btn-disabled"),a.innerHTML="...",this.XK=new z.yp(!1),this.o().g(this.XK,"success",this.BO),a="qid\x3d"+a.getAttribute("data-qid")+"\x26uid\x3d"+z.Y.ae+"\x26op\x3drecover",this.XK.ajax("/question/askpeople",a,"POST")))};
z.e.EB=function(a){var b=z.Rn(new z.th(window.location.href),"filter_by");(a=a.target)&&a.value&&(a=a.value,a!==b&&(window.location.href="/question/invited?filter_by\x3d"+a))};z.e.vq=function(a){z.V.add(a,"zg-btn-disabled");this.oT=new z.yp(!1);var b="qid\x3d"+a.getAttribute("data-qid")+"\x26uid\x3d"+z.Y.ae+"\x26op\x3dpass";this.oT.ajax("/question/askpeople",b,"POST");(a=a.parentNode)&&z.Er(a,!0)};z.e.BO=function(){this.YK=!1;this.xc(this.WK,"ignore");this.WK.name="ignore"};
z.e.xc=function(a,b){var c=a.parentNode,d=z.L("zm-invite-item-info-label",c);"ignore"===b?(z.V.remove(a,"zg-btn-disabled"),z.V.remove(a,"recover"),z.V.add(a,"ignore"),z.V.add(c,"invite"),z.V.remove(c,"ignore"),d.innerHTML="新邀请",a.name="ignore",a.innerHTML="忽略"):(z.V.remove(a,"zg-btn-disabled"),z.V.remove(a,"ignore"),z.V.add(a,"recover"),z.V.remove(c,"invite"),z.V.remove(c,"draft"),z.V.add(c,"ignore"),d.innerHTML="已忽略",a.name="recover",a.innerHTML="恢复")};
z.e.nT=function(){this.bA||(this.bA=!0,this.fI=new z.yp(!1),this.o().g(this.fI,"success",this.zO),this.fI.ajax("/question/askpeople","uid\x3d"+z.Y.ae+"\x26op\x3dignore_all","POST"))};z.e.zO=function(){this.bA=!1;z.P(this.aA,void 0);this.bA=!1;z.A(z.Wo("zm-invite-item-control"),(0,z.t)(function(a){this.xc(a,"recover")},this))};z.y(rJ,z.Q);rJ.prototype.init=function(){sJ();tJ(this)};window.$.validator.addMethod("unique",function(a,b,c){function d(){var d=window.$.validator.format('[data-rule-unique\x3d"{1}"][name!\x3d"{0}"]',b.name,c);return!(0,window.$)(d).filter(function(){return(0,window.$)(this).val()===a}).length}return this.optional(b)||d()},"不能填写重复的值");z.y(uJ,z.Q);uJ.prototype.init=function(){vJ()};z.y(wJ,z.Q);wJ.prototype.init=function(){var a=window.location.hash.slice(1);a&&(z.Lr((0,window.$)("."+a).get(0)),(0,window.$)(".zh-friendliness-sidenav").find('[data-section\x3d"'+a+'"]').addClass("active"));(0,window.$)(".zh-friendliness-sidenav a").click(function(b){a=(0,window.$)(b.target).data("section");z.Lr((0,window.$)("."+a).get(0));(0,window.$)(".zh-friendliness-sidenav a").removeClass("active");(0,window.$)(b.target).addClass("active")})};z.n(yJ,z.mk);yJ.prototype.C=function(){z.mk.prototype.C.call(this)};yJ.prototype.B=function(){z.mk.prototype.B.call(this);this.aa('\n      \x3cdiv class\x3d"publication-qrcodePayDialogContent"\x3e\n        \x3cimg src\x3d"/qrcode?url\x3d'+(0,window.encodeURIComponent)(this.url)+'" alt\x3d"扫码支付" width\x3d"212" height\x3d"212" /\x3e\n        \x3ci class\x3d"spinner spinner-gray"\x3e\x3c/i\x3e\n        \x3ch2\x3e\x3ci class\x3d"PaymentIcon wechat-pay"\x3e\x3c/i\x3e微信支付\x3c/h2\x3e\n        \x3cp\x3e可能遇到跨号支付问题，长按图片，选择「识别二维码」付款\x3c/p\x3e\n      \x3c/div\x3e\n    ')};
z.y(xJ,z.Q);
xJ.prototype.init=function(){var a=this;this.w(window.document.body);var b=(0,window.$)(".js-nav"),c=(0,window.$)(".js-view");b.click(function(a){a=(0,window.$)(a.target);b.removeClass("is-active");a.addClass("is-active");c.removeClass("is-visible").eq(a.index()).addClass("is-visible")});AJ(this);(0,window.$)(".js-publication-buy").length&&CJ(this);DJ(this);EJ();this.oA();FJ(this);z.S.Xa((0,window.$)(".publication-header")[0],{module:"EBookItem"},function(){return{card:{content:{type:"EBook",token:a.token.toString(10)}}}})};
xJ.prototype.oA=function(){var a=(0,window.$)(".publication-header-actions-share").get(0);z.LD(a,"publications/"+this.type,this.token,window.location.origin+window.location.pathname)};
xJ.prototype.yU=function(){var a="",b=null;return function(c,d){c=void 0===c?z.r:c;d=void 0===d?"https://pay.zhihu.com/api/js":d;a&&d&&d!==a&&c(Error("A pay-sdk from different source has been load"));a=d;if(window.zhihu&&window.zhihu.pay)return window.zhihu.pay.ready(c);b||(b=window.$.getScript(d));return b.then(function(){return window.zhihu.pay.ready(c)},function(a){c(Error(a.statusText));b=null})}}();z.x("ZH.entryRQ3",function(){(new dJ).init()});z.x("ZH.entryTerms",function(){(new hJ).init()});z.x("ZH.entryNotifications",function(){(new iJ).init()});z.x("ZH.entryQuestionLog",function(){(new jJ).init()});z.x("ZH.entryTS",function(){(new lJ).init()});z.x("ZH.entryDraft",function(){(new pJ).init()});z.x("ZH.entryQuestionInvited",function(){(new qJ).init()});z.x("ZH.entryCopyright",function(){(new rJ).init()});z.x("ZH.entryCommunity",function(){(new uJ).init()});z.x("ZH.entryFriendlinessPage",function(){(new wJ).init()});
z.x("ZH.entryPublicationPage",function(a){(new xJ(a)).init()});z.x("ZH.entryMobileUnblock",function(){var a=(0,window.$)("#AnitiSpamUnblockHolder")[0];if(a){var b=new z.Kq(function(a){return window.document.title=a},!1);b.g("complete",GJ);b.render(a)}});z.x("ZH.entryBalancePage",function(){var a=window.document.getElementById("react");if(a){var b=z.ux();z.sx("BalanceApp").then(function(c){c.render(a,b)})}});z.x("ZH.entryCouponPage",function(){var a=window.document.getElementById("react");a&&z.sx("CouponApp").then(function(b){return b.render(a)})});
z.lg("page-misc");}).call(this, __z_z__);
//# sourceURL=/static/revved/-/js/closure/page-misc.e112e288.js